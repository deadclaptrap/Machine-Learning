# -*- coding: utf-8 -*-
"""Ð‘Ñ€Ð¸Ð³Ð°Ð´Ð°_9.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1cZVNqfyZ2yo9PB01Q139OBTwRWK--tq7

##ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐº
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import scipy.stats as sps
import warnings
from tabulate import tabulate
warnings.filterwarnings('ignore')

from google.colab import drive
drive.mount('/content/drive')

"""##Ð§Ñ‚ÐµÐ½Ð¸Ðµ Ð¸ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…"""

df = pd.read_csv("/content/Salary.csv")
df["Age"] = df["Age"].astype(int)
df["Years of Experience"] = df["Years of Experience"].astype(int)
df["Gender"] = df["Gender"].astype('category')
df["Job Title"] = df["Job Title"].astype('category')
df["Country"] = df["Country"].astype('category')
df["Race"] = df["Race"].astype('category')
df["Senior"] = df["Senior"].replace({0:"No", 1: "Yes"}).astype('category')
df["Education Level"] = df["Education Level"]\
                        .replace({0:"High School", 1: "Bachelor Degree", 2:"Master Degree", 3: "Phd"})\
                        .astype('category')

df.head()

df.tail()

df.dtypes

print(f"DataFrame Shape: {df.shape}")

unique_counts = pd.DataFrame.from_records([(col, df[col].nunique()) for col in df.columns],
                                          columns=['Column_Name', 'Num_Unique']).sort_values(by=['Num_Unique'])
unique_counts

unique_counts[unique_counts['Column_Name'] == 'Job Title']

df_tmp = pd.DataFrame(df['Job Title'].value_counts())
df_tmp.reset_index(inplace= True )
plt.bar(df_tmp['Job Title'], df_tmp['count'])
plt.xticks(rotation=90)
plt.show()

job_technology = ['Software Engineer', 'Software Developer', 'IT Support',
          'Network Engineer', 'Web Developer', 'Web Designer', 'IT Manager', 'IT Support Specialist',
          'IT Project Manager', 'IT Consultant', 'Software Architect', 'Back end Developer',
          'Full Stack Engineer', 'Front end Developer', 'Developer', 'Front End Developer', 'Back End Developer']

job_analyze = ['Data Analyst', 'Marketing Analyst', 'Business Analyst', 'Data Scientist',
               'Business Intelligence Analyst', 'Supply Chain Analyst',
               'Quality Assurance Analyst', 'Financial Analyst', 'Data Engineer', 'Operations Analyst',
               'Data Entry Clerk', 'Training Specialist', 'Business Operations Analyst']

job_control = ['Software Engineer Manager', 'Manager', 'Director', 'VP of Operations', 'VP of Finance', 'Chief Technology Officer',
               'Chief Data Officer', 'Director of Marketing', 'Director of Operations', 'Director of Sales and Marketing',
               'Director of Human Resources', 'Director of Product Management', 'Director of Business Development',
               'Director of Engineering', 'Director of HR', 'Director of Data Science', 'Research Director',
               'Operations Manager', 'Operations Coordinator', 'Operations Analyst', 'Supply Chain Manager',
               'Administrative Assistant', 'Director of Finance', 'Office Manager', 'Product Development Manager',
               'Product Manager', 'Creative Director', 'Human Resources Director', 'Sales Director', 'Operations Director',
               'Director of Finance', 'Director of Human Capital', 'CEO', 'Director of Data Science',
               'HR Manager', 'HR Generalist', 'HR Coordinator', 'HR Specialist', 'Juniour HR Generalist',
               'Juniour HR Coordinator', 'Human Resources Manager', 'Human Resources Coordinator', 'Human Resources Specialist',
               'Chief Data Officer', 'Project Manager', 'Software Manager', 'Software Project Manager', 'Marketing Director']

job_marketing = ['Marketing Manager', 'Marketing Coordinator', 'Marketing Manager',
                 'Marketing Specialist', 'Social Media Specialist', 'Copywriter', 'Digital Marketing Manager',
                 'Product Marketing Manager', 'Advertising Coordinator',
                 'Sales Representative', 'Account Executive', 'Digital Marketing Specialist',
                 'Social Media Manager', 'Content Marketing Manager', 'Social Media Specialist', 'Strategy Consultant',
                 'Account Manager']

job_creativity = ['Digital Content Producer', 'Product Designer', 'Graphic Designer', 'UX Researcher', 'Copywriter', 'Technical Writer',
                  'Project Engineer', 'Designer', 'UX Designer']

job_client = ['Customer Service Rep', 'Customer Success Rep', 'Customer Service Manager',
              'Customer Support Specialist', 'Customer Success Manager','Receptionist',
              'Delivery Driver', 'Public Relations Manager',
              'Event Coordinator', 'Help Desk Analyst', 'Customer Service Manager',
              'Customer Service Representative', 'Technical Recruiter', 'Technical Support Specialist',
              'Recruiter', 'Receptionist', 'Social Media Man', 'Delivery Driver']

job_consult = ['Sales Executive', 'Director of Sales', 'Financial Manager', 'Accountant', 'Financial Advisor', 'Strategy Consultant', 'Consultant',
                'Business Development Manager', 'Business Development Associate', 'Financial Advisor',
               'Sales Manager', 'Sales Operations Manager', 'Product Development Manager', 'Sales Associate']

job_science = ['Engineer', 'Scientist', 'Principal Scientist', 'Research Scientist', 'Researcher',
               'Project Coordinator', 'Event Coordinator', 'Public Relations Manager',
               'Operations Coordinator', 'Product Development Manager', 'Principal Engineer']

job_catalog = ['job_technology', 'job_analyze', 'job_control', 'job_marketing', 'job_creativity', 'job_client', 'job_consult', 'job_science']
job_1 = [job_technology, job_analyze, job_control, job_marketing, job_creativity, job_client, job_consult, job_science]

list_job = list(df['Job Title'])

for p in range(len(list_job)):
  for n in job_catalog:
    if list_job[p] in job_1[job_catalog.index(n)]:
      list_job[p] = n
      break

df_job_group = pd.DataFrame({"Job Group": list_job})
df_job_group = pd.concat([df, df_job_group], axis=1)
df_job_group = df_job_group.drop(columns=['Job Title'])
df_job_group["Job Group"] = df_job_group["Job Group"].astype('category')

df_tmp = pd.DataFrame(df_job_group['Job Group'].value_counts())
df_tmp.reset_index(inplace= True )
plt.bar(df_tmp['Job Group'], df_tmp['count'])
plt.xticks(rotation=90)
plt.show()

"""##ÐžÐ¿Ð¸ÑÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°"""

def describe_column(dataframe, column_name, i):
    data = dataframe[column_name]
    cnt, mean, std, *quartiles = data.describe()
    x_min, lower_quartile, x_median, upper_quartile, x_max = quartiles
    interquartile_range = upper_quartile - lower_quartile
    df_isna = list(dataframe.isna().sum())
    skewness = sps.skew(data)
    kurtosis = sps.kurtosis(data)
    return {
        "ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ":column_name,
        "Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ": mean,
        "ÐœÐµÐ´Ð¸Ð°Ð½Ð°": x_median,
        "Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ðµ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ðµ":std,
        "ÐœÐµÐ¶ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼Ð°Ñ…": interquartile_range,
        "Ð’ÐµÑ€Ñ…Ð½ÑÑ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ð»ÑŒ": upper_quartile,
        "ÐÐ¸Ð¶Ð½ÑÑ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ð»ÑŒ": lower_quartile,
        "ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ Ð°ÑÐ¸Ð¼Ð¼ÐµÑ‚Ñ€Ð¸Ð¸": skewness,
        "ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ ÑÐºÑÑ†ÐµÑÑÐ°": kurtosis,
        "ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ": x_min,
        "ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ": x_max,
        "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ð¹": cnt,
        "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹": df_isna[i]}

numerical_columns = [
    'Age',
    'Years of Experience',
    'Salary'
]

quality_columns = list(set(df_job_group.columns) - set(numerical_columns))

descr_df_1 = []
i = 0
for n in numerical_columns:
  descr_df_1.append(describe_column(df, n, i))
  i += 1

pd.DataFrame(descr_df_1).set_index(['ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ']).transpose()

df_tmp = df.select_dtypes(include=["float", "int"])
discr_df = df_tmp.describe()
w = df_tmp.quantile(q=0.75) - df_tmp.quantile(q=0.25)
df_w = pd.DataFrame([w], index=['IQR'])
df_isna = pd.DataFrame([df_tmp.isna().sum()], index=['Count of Null values'])
discr_df = pd.concat([discr_df, df_w])
discr_df = pd.concat([discr_df, df_w])
discr_df

"""##Ð’Ñ‹Ð±Ñ€Ð¾ÑÑ‹"""

print('\033[1mCount of outliers for numerical values\033[0m')
for col in numerical_columns:
  irq = df_w[col]
  wisker_u = (discr_df.loc['75%', col] + 1.5*irq).values[0]
  wisker_l = (discr_df.loc['25%', col] - 1.5*irq).values[0]
  sel = (df_tmp[col] > wisker_u) + (df_tmp[col] <= wisker_l)
  out = df_tmp.loc[sel, :]
  print(f'\033[1m{col} outlier: \033[0m{len(out)}')

fig, axes = plt.subplots(1, 2, figsize=(12, 6))

sns.boxplot(x=df["Age"], ax=axes[0])
axes[0].set_title("Box-plot of 'Age'")

sns.boxplot(x=df["Years of Experience"], ax=axes[1])
axes[1].set_title("Box-plot of 'Years of Experience'")

plt.tight_layout()

plt.show()

"""##Ð˜Ð·Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð±Ð¸Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ñ€Ð°Ð·Ð±Ð¸ÐµÐ½Ð¸Ñ Ð½Ð° Ð´Ð²Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹

"""

dfn = df_job_group.select_dtypes(include=['int', 'float64'])
# ÐÐµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ. ÐŸÑ€Ð¾ÑÑ‚ÐµÐ¹ÑˆÐ¸Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚.
#dfn.hist(bins='fd', density=True, grid=True, legend=False, color=None)
# Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ. Ð Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð½Ð° Ð»Ð¸ÑÑ‚Ðµ (Pandas Ð¸ Matplotlib).
# ÐÐµ Ð±Ð¾Ð»ÐµÐµ, Ñ‡ÐµÐ¼ Ð¿Ð¾ Ñ‚Ñ€Ð¸ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð² ÑÑ‚Ð¾Ð»Ð±Ñ†Ðµ
nrow = dfn.shape[1]
fig, ax_lst = plt.subplots(nrow, 1)
fig.figsize=(15, 9) # Ð”ÑŽÐ¹Ð¼Ñ‹
nplt = -1
tit = {'Age':'Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚', 'Education Level': "Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ", "Years of Experience": "ÐžÐ¿Ñ‹Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹", "Salary": "Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°"}
for nplt, s in enumerate(dfn.columns):
    # ax_lst[nplt].hist(dfn[[s]], bins='fd', density=True, color=None)
    dfn.hist(column=s, ax=ax_lst[nplt], bins='fd', density=True, grid=True,
             legend=False, color=None)
#    ax_lst[nplt].hist(dfn[s], bins='fd', density=True, color='darkkhaki')
    # ax_lst[nplt].grid(visible=True)
    ax_lst[nplt].set_title(tit[s], fontdict={'fontsize':15, 'color':'blue'}, loc='left')
fig.subplots_adjust(wspace=0.5, hspace=1.0)
fig.suptitle(f'Ð“Ð¸ÑÑ‚Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… {list(dfn.columns)}')
plt.savefig('/content/drive/MyDrive/graphics/jobs_qnt.pdf', format='pdf')
plt.show()

fig, axs = plt.subplots(3, 1, figsize=(12, 6))

sns.histplot(df_job_group["Age"], kde=True, ax=axs[0])
axs[0].set_title("Age Distribution")

sns.histplot(df_job_group["Years of Experience"], kde=True, ax=axs[1])
axs[1].set_title("Years of Experience Distribution")

sns.histplot(df_job_group["Salary"], kde=True, ax=axs[2])
axs[2].set_title("Salary")

plt.tight_layout()
plt.savefig('/content/drive/MyDrive/graphics/jobs_qnt_2.pdf', format='pdf')

plt.show()

df_job_group_poor = df_job_group[df_job_group['Salary'] <= 130000]
df_job_group_rich = df_job_group[df_job_group['Salary'] >= 140000]

fig, axs = plt.subplots(1, 2, figsize=(12, 6))

sns.histplot(df_job_group_poor["Salary"], kde=True, ax=axs[0])
axs[0].set_title("Salary poor employee")

sns.histplot(df_job_group_rich["Salary"], kde=True, ax=axs[1])
axs[1].set_title("Salary rich employee")

plt.tight_layout()
plt.savefig('/content/drive/MyDrive/graphics/jobs_qnt_pr.pdf', format='pdf')

plt.show()

def describe_column(dataframe, column_name, i, name):
    data = dataframe[column_name]
    cnt, mean, std, *quartiles = data.describe()
    x_min, lower_quartile, x_median, upper_quartile, x_max = quartiles
    interquartile_range = upper_quartile - lower_quartile
    df_isna = list(dataframe.isna().sum())
    skewness = sps.skew(data)
    kurtosis = sps.kurtosis(data)
    return {
        "ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ":name,
        "Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ": mean,
        "ÐœÐµÐ´Ð¸Ð°Ð½Ð°": x_median,
        "Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ðµ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ðµ":std,
        "ÐœÐµÐ¶ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼Ð°Ñ…": interquartile_range,
        "Ð’ÐµÑ€Ñ…Ð½ÑÑ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ð»ÑŒ": upper_quartile,
        "ÐÐ¸Ð¶Ð½ÑÑ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ð»ÑŒ": lower_quartile,
        "ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ Ð°ÑÐ¸Ð¼Ð¼ÐµÑ‚Ñ€Ð¸Ð¸": skewness,
        "ÐšÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚ ÑÐºÑÑ†ÐµÑÑÐ°": kurtosis,
        "ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ": x_min,
        "ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ": x_max,
        "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ð¹": cnt,
        "ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹": df_isna[i]}

result = []
result.append(describe_column(df_job_group_poor, 'Salary', 0, 'Salary_lower_part'))
result.append(describe_column(df_job_group_rich, 'Salary', 1, 'Salary_upper_part'))
result = pd.DataFrame(result).set_index(['ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ']).transpose()
result

"""##ÐžÐ¿Ð¸ÑÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ð°"""

df_tmp = df_job_group_poor.select_dtypes(include=["float", "int"])
discr_df = df_tmp.describe()
w = df_tmp.quantile(q=0.75) - df_tmp.quantile(q=0.25)
df_w = pd.DataFrame([w], index=['IQR'])
df_isna = pd.DataFrame([df_tmp.isna().sum()], index=['Count of Null values'])
discr_df = pd.concat([discr_df, df_w])
discr_df

"""##Ð’Ñ‹Ð±Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ð°"""

print('\033[1mCount of outliers for numerical values\033[0m')
for col in numerical_columns:
  irq = df_w[col]
  wisker_u = (discr_df.loc['75%', col] + 1.5*irq).values[0]
  wisker_l = (discr_df.loc['25%', col] - 1.5*irq).values[0]
  sel = (df_tmp[col] > wisker_u) + (df_tmp[col] <= wisker_l)
  out = df_tmp.loc[sel, :]
  print(f'\033[1m{col} outlier: \033[0m{len(out)}')

fig, axes = plt.subplots(1, 2, figsize=(12, 6))

sns.boxplot(x=df_job_group_poor["Age"], ax=axes[0])
axes[0].set_title("Box-plot of 'Age'")

sns.boxplot(x=df_job_group_poor["Years of Experience"], ax=axes[1])
axes[1].set_title("Box-plot of 'Years of Experience'")

plt.tight_layout()
plt.savefig('/content/drive/MyDrive/graphics/jobs_outliers_poor.pdf', format='pdf')
plt.show()

"""##ÐÐ½Ð°Ð»Ð¸Ð· Ð²Ð·Ð°Ð¸Ð¼Ð¾ÑÐ²ÑÐ·Ð¸"""

from scipy.stats import pearsonr, spearmanr, kendalltau

# Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð·Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ†ÐµÐ½Ð¾Ðº ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°
C_P = pd.DataFrame([], index=df_tmp.columns, columns=df_tmp.columns, dtype='float')
# Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð·Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ†ÐµÐ½Ð¾Ðº ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°
P_P = pd.DataFrame([], index=df_tmp.columns, columns=df_tmp.columns, dtype='float')
# Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¾Ñ†ÐµÐ½Ð¾Ðº ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°
C_S = pd.DataFrame([], index=df_tmp.columns, columns=df_tmp.columns, dtype='float')
# Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð·Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ†ÐµÐ½Ð¾Ðº ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°
P_S = pd.DataFrame([], index=df_tmp.columns, columns=df_tmp.columns, dtype='float')
# Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð·Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ†ÐµÐ½Ð¾Ðº ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ Ð¢Ð°Ñƒ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð°
C_K = pd.DataFrame([], index=df_tmp.columns, columns=df_tmp.columns, dtype='float')
# Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð·Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ†ÐµÐ½Ð¾Ðº ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ Ð¢Ð°Ñƒ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð°
P_K = pd.DataFrame([], index=df_tmp.columns, columns=df_tmp.columns, dtype='float')
for x in df_tmp.columns:
    for y in df_tmp.columns:
      C_P.loc[x,y], P_P.loc[x,y] = pearsonr(df_tmp[x], df_tmp[y])
      C_S.loc[x,y], P_S.loc[x,y] = spearmanr(df_tmp[x], df_tmp[y])
      C_K.loc[x,y], P_K.loc[x,y] = kendalltau(df_tmp[x], df_tmp[y])

with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl") as wrt:
# ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°
    discr_df.to_excel(wrt, sheet_name='stat')
# ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°
    C_P.to_excel(wrt, sheet_name='Pearson')
    dr = C_P.shape[0] + 2
    P_P.to_excel(wrt, startrow=dr, sheet_name='Pearson') # Ð—Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚ÑŒ
# ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°
    C_S.to_excel(wrt, sheet_name='Spirmen')
    dr = C_S.shape[0] + 2
    P_S.to_excel(wrt, startrow=dr, sheet_name='Spirmen') # Ð—Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚ÑŒ
# ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¢Ð°Ñƒ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð°
    C_K.to_excel(wrt, sheet_name='Tau_Kendall')
    dr = C_K.shape[0] + 2
    P_K.to_excel(wrt, startrow=dr, sheet_name='Tau_Kendall') # Ð—Ð½Ð°Ñ‡Ð¸Ð¼Ð¾ÑÑ‚ÑŒ

result = []
for n in numerical_columns:
  if n != 'Salary':
    result.append({'ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ': n,
                   'ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°': C_P.loc[n, 'Salary'],
                   'Pvalue ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°': P_P.loc[n, 'Salary'],
                   'ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°': C_S.loc[n, 'Salary'],
                   'Pvalue ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°': P_S.loc[n, 'Salary'],
                   'ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð° Ñ‚Ð°Ñƒ': C_K.loc[n, 'Salary'],
                   'Pvalue ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð° Ñ‚Ð°Ñƒ': P_K.loc[n, 'Salary']})

pd.DataFrame(result).set_index(['ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ']).transpose()

result = []
result.append({'ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ': 'Age-Years of Experience',
                   'ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°': C_P.loc['Age', 'Years of Experience'],
                   'Pvalue ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐŸÐ¸Ñ€ÑÐ¾Ð½Ð°': P_P.loc['Age', 'Years of Experience'],
                   'ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°': C_S.loc['Age', 'Years of Experience'],
                   'Pvalue ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¡Ð¿Ð¸Ñ€Ð¼ÐµÐ½Ð°': P_S.loc['Age', 'Years of Experience'],
                   'ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð° Ñ‚Ð°Ñƒ': C_K.loc['Age', 'Years of Experience'],
                   'Pvalue ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ ÐšÐµÐ½Ð´Ð°Ð»Ð»Ð° Ñ‚Ð°Ñƒ': P_K.loc['Age', 'Years of Experience']})

pd.DataFrame(result).set_index(['ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ']).transpose()

"""## ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰ÐµÐ¹"""

from scipy.stats import kruskal

def crusk_vals(nv, f):
      names = df_job_group_poor[nv].unique()
      res = []
      for val in names:
            val_true = df_job_group_poor[nv]== val
            res.append(df_job_group_poor.loc[val_true, 'Salary'])
      # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐºÑ€Ð¸ÐµÑ‚Ñ€Ð¸Ð¹ ÐšÑ€ÑƒÑÐºÐ°Ð»Ð°-Ð£Ð¾Ð»Ð»Ð¸ÑÐ°
      salary_amount = kruskal(*res)
      # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚
      with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as f:
            print(f'ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ ÐšÑ€ÑƒÑÐºÐ°Ð»Ð°-Ð£Ð¾Ð»Ð»Ð¸ÑÐ° Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… \'Salary\' Ð¸ \'{nv}\'',
                  file=f)
            print(salary_amount, file=f)

nom_vals = df_job_group_poor.select_dtypes(include=["category"])
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'w') as file_n:
      for name_val in nom_vals.columns:
            crusk_vals(name_val, file_n)

"""##ÐÐ½Ð°Ð»Ð¸Ð· Ð²Ð·Ð°Ð¸Ð¼Ð¾ÑÐ²ÑÐ·Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ Ð´Ð²ÑƒÐ¼Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸"""

import statsmodels.api as sm
from itertools import combinations
# Ð§Ð¸Ñ‚Ð°ÐµÐ¼ Ð¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
for left, right in combinations(nom_vals.columns, 2):
  crtx = pd.crosstab(df_job_group_poor[left], df_job_group_poor[right], margins=True)
  crtx.columns.name = right
  crtx.index.name = left + '\\' +right
  tabx = sm.stats.Table(crtx)
# Ð˜Ð· ÑƒÐ¶Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ¾Ð¿Ñ€ÑÐ¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸
# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚ sm.stats.Table Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
# Ð’ Ð¾Ð±ÑŠÐµÐºÑ‚Ðµ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð²ÑÐµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¸ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹
  # ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ sm.stats.Table
  #table = sm.stats.Table.from_data(CA[['music', 'signal']])
  # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
  with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                      if_sheet_exists='overlay', mode='a') as wrt:
  # Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÐ¾Ð¿Ñ€ÑÐ¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸
      tabx.table_orig.to_excel(wrt, sheet_name=left + '-' + right)
      dr = tabx.table_orig.shape[0] + 2 # Ð¡Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼
  # ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ñ‹ Ð¿Ñ€Ð¸ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
      tabx.fittedvalues.to_excel(wrt, sheet_name=left + '-' + right, startrow=dr)
  # ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ Ñ…Ð¸ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ð½Ð¾Ð¼Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
  resx = tabx.test_nominal_association()
  # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² Ñ„Ð°Ð¹Ð»Ðµ
  with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
      print(f'ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ HI^2 Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… \'{left}\' Ð¸ \'{right}\'',
            file=fln)
      print(resx, file=fln)

  # Ð Ð°ÑÑÑ‡ÐµÑ‚ Cramer V Ð¿Ð¾ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ðµ
  nr = tabx.table_orig.shape[0]
  nc = tabx.table_orig.shape[1]
  N = tabx.table_orig.iloc[nr-1, nc-1]
  hisq = resx.statistic
  CrV = np.sqrt(hisq/(N*min((nr - 1, nc - 1))))
  with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
      print(f'Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Cramer V Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… \'{left}\' Ð¸ \'{right}\'',
            file=fln)
      print(CrV, file=fln)

arr = [['Race', 'Job Group']]
res = []
for left, right in arr:
  crtx = pd.crosstab(df_job_group_poor[left], df_job_group_poor[right], margins=True)
  crtx.columns.name = right
  crtx.index.name = left + '\\' +right
  tabx = sm.stats.Table(crtx)
# Ð˜Ð· ÑƒÐ¶Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ¾Ð¿Ñ€ÑÐ¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸
# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚ sm.stats.Table Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
# Ð’ Ð¾Ð±ÑŠÐµÐºÑ‚Ðµ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð²ÑÐµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¸ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹
  # ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ sm.stats.Table
  #table = sm.stats.Table.from_data(CA[['music', 'signal']])
  # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
  # ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ñ‹ Ð¿Ñ€Ð¸ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
  # ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ Ñ…Ð¸ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ð½Ð¾Ð¼Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
  resx = tabx.test_nominal_association()
  # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² Ñ„Ð°Ð¹Ð»Ðµ

  # Ð Ð°ÑÑÑ‡ÐµÑ‚ Cramer V Ð¿Ð¾ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ðµ
  nr = tabx.table_orig.shape[0]
  nc = tabx.table_orig.shape[1]
  N = tabx.table_orig.iloc[nr-1, nc-1]
  hisq = resx.statistic
  CrV = np.sqrt(hisq/(N*min((nr - 1, nc - 1))))
  res.append({'Ð¡Ð²ÑÐ·ÑŒ': f'{arr[0][0]} - {arr[0][1]}',
              'Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ðœ’2': resx.statistic,
              'ðœ’2 test p-value': resx.pvalue,
              'V  ÐšÑ€Ð°Ð¼ÐµÑ€Ð°': CrV})

"""##Ð“Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·"""

df_tmp = pd.DataFrame(df_job_group_poor['Job Group'].value_counts())
df_tmp.reset_index(inplace= True )
plt.bar(df_tmp['Job Group'], df_tmp['count'])
plt.xticks(rotation=90)
plt.savefig('/content/drive/MyDrive/graphics/jobs_bar_group.pdf', format='pdf')
plt.show()

dfn = df_job_group_poor.select_dtypes(include=["category"])
plt.figure(figsize=(15, 15)) # Ð”ÑŽÐ¹Ð¼Ñ‹
plt.subplots_adjust(wspace=0.5, hspace=0.1)
nplt = 0
nrow = dfn.shape[1]//2
ncol = nrow
tit = {'Senior':'Ð Ð°Ð±Ð¾Ñ‚Ð° Ð² ÑˆÐºÐ¾Ð»Ðµ','Job Group': 'Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹', 'Education Level': 'Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ', 'Gender': "ÐŸÐ¾Ð»", "Country": "Ð¡Ñ‚Ñ€Ð°Ð½Ð°", "Race": "Ð Ð°ÑÐ°"}
for nplt, s in enumerate(dfn.columns):
    ax = plt.subplot(nrow, ncol, nplt + 1)
    ftb = pd.crosstab(dfn[s], s)
    ftb.index.name = 'ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸'
    ftb.plot.pie(subplots=True, table=True, ax=ax, grid=True, legend=False)
    ax.set_title(tit[s], fontdict={'fontsize':15, 'color':'blue'}, loc='right')
plt.savefig('/content/drive/MyDrive/graphics/jobs_nom_poor.pdf', format='pdf')

dfn = df_job_group_poor.select_dtypes(include="category")
plt.figure(figsize=(15, 15)) # Ð”ÑŽÐ¹Ð¼Ñ‹
plt.subplots_adjust(wspace=0.5, hspace=1)
nplt = 0
nrow = dfn.shape[1]//2
ncol = nrow
tit = {'Senior':'Ð Ð°Ð±Ð¾Ñ‚Ð° Ð² ÑˆÐºÐ¾Ð»Ðµ','Job Group': 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹', 'Education Level': 'Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ', 'Gender': "ÐŸÐ¾Ð»", "Country": "Ð¡Ñ‚Ñ€Ð°Ð½Ð°", "Race": "Ð Ð°ÑÐ°"}
for nplt, s in enumerate(dfn.columns):
    ax = plt.subplot(nrow, ncol, nplt + 1)
    ftb = pd.crosstab(dfn[s], s)
    ftb.index.name = 'ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸'
    ftb.plot.bar(subplots=True, table=False, ax=ax, grid=True, legend=False, label='')
    ax.set_title(tit[s], fontdict={'fontsize':15, 'color':'blue'}, loc='right')
plt.savefig('/content/drive/MyDrive/graphics/jobs_bar_poor.pdf', format='pdf')

fig, axes = plt.subplots(ncols=5, nrows=3, figsize=(20, 20))
cols = nom_vals
for i, (left, right) in enumerate(combinations(cols.columns, 2)):
  sns.histplot(data=df_job_group_poor, x=left, hue=right, ax=axes[i%3][i%5], multiple="stack")
  axes[i%3][i%5].tick_params(axis='x', rotation=90)
fig.subplots_adjust(wspace=0.3, hspace=0.5)
plt.savefig('/content/drive/MyDrive/graphics/jobs_combo_poor.pdf', format='pdf')
plt.tight_layout()
plt.show()

# ÐžÑ‚Ð±Ð¾Ñ€ Ð¸Ð¼ÐµÐ½ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
cols = df_job_group_poor.select_dtypes(include=['category'])
cols = cols.columns
# ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð² Ð² ÑÑ‚Ð¾Ð»Ð±Ñ†Ðµ
nrow = len(cols) # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð² cols
fig, ax_lst = plt.subplots(nrow, 1, figsize=(15, 15)) # Ð”ÑŽÐ¹Ð¼Ñ‹
for nplt, s in enumerate(cols):
# Ð”Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹ ÑÑ‚Ñ€Ð¾ÑÑ‚ÑÑ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð¼ Ð±ÑƒÑ‚ÑÑ‚Ñ€ÐµÐ¿Ð°
    df_job_group_poor.boxplot(column='Salary', by=s, ax=ax_lst[nplt], grid=True, notch=True,
                bootstrap=40, showmeans=True, color=None)
    ax_lst[nplt].tick_params(axis='x', rotation=45)
fig.subplots_adjust(wspace=0.3, hspace=2.5)
# ÐžÐ±Ñ‰Ð°Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒ Ðº Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°Ð¼
fig.suptitle('ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¸Ð°Ð³Ð°Ñ€Ð¼Ð¼Ñ‹ Ð‘Ð¾ÐºÑÐ°-Ð’Ð¸ÑÐºÐµÑ€Ð°')
plt.savefig('/content/drive/MyDrive/graphics/job_qqdep_poor.pdf', format='pdf')
plt.show()

dfn = df_job_group_poor.select_dtypes(include=['float64', 'int'])
nrow = dfn.shape[1] - 1 # Ð£Ñ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾Ð´Ð½Ð° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ñ†ÐµÐ»ÐµÐ²Ð°Ñ - Ð¾ÑÑŒ 'Y'
fig, ax_lst = plt.subplots(nrow, 1)
fig.figsize=(15, 9) # Ð”ÑŽÐ¹Ð¼Ñ‹
nplt = -1
for s in dfn.columns[:-1]: # ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ - Ñ†ÐµÐ»ÐµÐ²Ð°Ñ ('Y')
    nplt += 1
    dfn.plot.scatter(s, 'Salary', ax=ax_lst[nplt])
    ax_lst[nplt].grid(visible=True)
    ax_lst[nplt].set_title(f'Ð¡Ð²ÑÐ·ÑŒ Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ñ‹ Ñ {s}')
fig.subplots_adjust(wspace=1, hspace=0.9)
"""
ÐžÐ±Ñ‰Ð°Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒ Ðº Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°Ð¼
Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ 'f'-ÑÑ‚Ñ€Ð¾ÐºÐ¸
{} - Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
"""
fig.suptitle(f'Ð¡Ð²ÑÐ·ÑŒ Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ñ‹ Ñ {list(dfn.columns[:-1])}')
plt.savefig('/content/drive/MyDrive/graphics/job_scat_poor.pdf', format='pdf')
plt.show()

"""##ÐœÐ¾Ð´ÐµÐ»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ"""

import numpy as np
import pandas as pd
import matplotlib as mpl
import matplotlib.pyplot as plt

import statsmodels.api as sm
# Ð§Ð¸Ñ‚Ð°ÐµÐ¼ Ð¸ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
JB = df_job_group_poor.copy()
# Ð Ð°Ð·Ð±Ð¸ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ð° Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ñ‡Ð½Ð¾Ðµ Ð¸ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ðµ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾
# frac- Ð´Ð¾Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ñ‡Ð½Ð¾Ð¼ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ
# random_state - Ð´Ð»Ñ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð±Ð¾Ñ€Ð° Ñ‚ÐµÑ… Ð¶Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
JB_train = JB.sample(frac=0.8, random_state=42)
# Ð¡Ð¸Ð¼Ð²Ð¾Ð» ~ Ð¾Ð±Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ð½Ð¸Ðµ (not)
JB_test = JB.loc[~JB.index.isin(JB_train.index)]

# Ð‘ÑƒÐ´ÐµÐ¼ Ð½Ð°ÐºÐ°Ð¿Ð»Ð¸Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¿Ð¾ÑÑ‚Ñ€ÐµÐ¾Ð½Ð½Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼  adjR^2 Ð¸ AIC
mq = pd.DataFrame([], columns=['R^2', 'adjR^2', 'AIC']) # Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ
test_results = pd.DataFrame(None, columns=["ÐœÐ¾Ð´ÐµÐ»ÑŒ", "RMSE", "AE", "Ð”Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ"])

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ†ÐµÐ»ÐµÐ²ÑƒÑŽ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ
Y = JB_train['Salary']
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ (dummy) Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²ÑÐµÑ… ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
DUM = pd.get_dummies(JB_train[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾

DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_control', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X = pd.concat([DUM, JB_train[['Age', 'Years of Experience']]], axis=1)
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X = sm.add_constant(X)
X = X.astype({'const':'int64'}) # Ð¡Ð¾ÐºÑ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg00 = sm.OLS(Y,X.astype(float))
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod00 = linreg00.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ******',
          file=fln)
    print(fitmod00.summary(), file=fln)

X = X.replace({False: 0, True : 1})

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod00.resid
WHT = pd.DataFrame(het_white(e, X), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het')

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod00.rsquared, fitmod00.rsquared_adj, fitmod00.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_base']).T
mq = pd.concat([mq, q])

"""Ð£Ð±ÐµÑ€ÐµÐ¼ Years of Expirience"""

X_1 = X.drop('Years of Experience', axis=1)
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg10 = sm.OLS(Y, X_1)
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod10 = linreg10.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ******',
          file=fln)
    print(fitmod10.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod10.rsquared, fitmod10.rsquared_adj, fitmod10.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_base_mod1']).T
mq = pd.concat([mq, q])

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ†ÐµÐ»ÐµÐ²ÑƒÑŽ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ
Y = JB_train['Salary']
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ (dummy) Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²ÑÐµÑ… ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
DUM = pd.get_dummies(JB_train[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾

DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X = pd.concat([DUM, JB_train[['Age']]], axis=1)
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X = sm.add_constant(X)
X = X.astype({'const':'int64'}) # Ð¡Ð¾ÐºÑ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg10 = sm.OLS(Y,X.astype(float))
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod10 = linreg10.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ******',
          file=fln)
    print(fitmod10.summary(), file=fln)

X = X.replace({False: 0, True : 1})

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif_YoE')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod10.resid
WHT = pd.DataFrame(het_white(e, X), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het_YoE')

"""Ð£Ð±ÐµÑ€ÐµÐ¼ Age"""

X_1 = X.drop('Age', axis=1)
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg11 = sm.OLS(Y, X_1)
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod11 = linreg11.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ******',
          file=fln)
    print(fitmod11.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod11.rsquared, fitmod11.rsquared_adj, fitmod11.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_base_mod2']).T
mq = pd.concat([mq, q])

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ†ÐµÐ»ÐµÐ²ÑƒÑŽ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ
Y = JB_train['Salary']
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ (dummy) Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²ÑÐµÑ… ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
DUM = pd.get_dummies(JB_train[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾

DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X = pd.concat([DUM, JB_train[['Years of Experience']]], axis=1)
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X = sm.add_constant(X)
X = X.astype({'const':'int64'}) # Ð¡Ð¾ÐºÑ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg11 = sm.OLS(Y,X.astype(float))
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod11 = linreg11.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ******',
          file=fln)
    print(fitmod11.summary(), file=fln)

X = X.replace({False: 0, True : 1})

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif_A')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod11.resid
WHT = pd.DataFrame(het_white(e, X), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het_A')

"""##Ð“Ð¸Ð¿Ð¾Ñ‚ÐµÐ·Ð° â„–1"""

X_1 = X.copy()
linreg01 = sm.OLS(Y,X_1)
fitmod01 = linreg01.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ 1 ******',
          file=fln)
    print(fitmod01.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod01.rsquared, fitmod01.rsquared_adj, fitmod01.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_1']).T
mq = pd.concat([mq, q])

"""##Ð“Ð¸Ð¿Ð¾Ñ‚ÐµÐ·Ð° â„–2"""

X_2 = X.copy()
X_2['Phd_F'] = X_2['Education Level_Phd'] * X_2['Gender_Female']
X_2['Not_Phd_F'] = (~X_2['Education Level_Phd']) * X_2['Gender_Female']
#X_2 = X_2.drop(columns=['Gender_Female', 'Education Level_Phd',
#                        'Education Level_Master Degree', 'Education Level_Bachelor Degree'])
linreg02 = sm.OLS(Y,X_2)
fitmod02 = linreg02.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ 2 ******',
          file=fln)
    print(fitmod02.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod02.rsquared, fitmod02.rsquared_adj, fitmod02.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_2']).T
mq = pd.concat([mq, q])

"""##Ð“Ð¸Ð¿Ð¾Ñ‚ÐµÐ·Ð° â„–3"""

X_3 = X.copy()
tmp = X_3['Years of Experience'] <= 5
X_3['Female_YoE'] = tmp * X_3['Gender_Female']
X_3['Male_YoE'] = tmp * (~X_3['Gender_Female'])
#X_3 = X_3.drop(columns=['Gender_Female','Years of Experience'])
linreg03 = sm.OLS(Y,X_3)
fitmod03 = linreg03.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ 3 ******',
          file=fln)
    print(fitmod03.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod03.rsquared, fitmod03.rsquared_adj, fitmod03.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_3']).T
mq = pd.concat([mq, q])

fig, axs = plt.subplots(1, 2, figsize=(12, 6))
tmp = df_job_group_poor[df_job_group_poor['Gender'] == 'Female']
sns.histplot(tmp['Years of Experience'], ax=axs[0])
axs[0].set_title("Female")

tmp_1 = df_job_group_poor[df_job_group_poor['Gender'] == 'Male']
sns.histplot(tmp_1['Years of Experience'], ax=axs[1])
axs[1].set_title("Male")

plt.tight_layout()
plt.savefig('/content/drive/MyDrive/graphics/jobs_bar_fm.pdf', format='pdf')

plt.show()

"""##Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ"""

X_4 = X.copy()
tmp = X_4['Years of Experience'] <= 3
X_4['Female_YoE'] = tmp * X_4['Gender_Female']
X_4['Male_YoE'] = tmp * (~X_4['Gender_Female'])
X_4['Phd_F'] = X_4['Education Level_Phd'] * X_4['Gender_Female']
X_4['Not_Phd_F'] = (~X_4['Education Level_Phd']) * X_4['Gender_Female']
linreg04 = sm.OLS(Y,X_4)
fitmod04 = linreg04.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ******',
          file=fln)
    print(fitmod04.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod04.rsquared, fitmod04.rsquared_adj, fitmod04.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_final']).T
mq = pd.concat([mq, q])

"""ÐžÑ†ÐµÐ½ÐºÐ° Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸"""

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X_4.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif_final')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod04.resid
WHT = pd.DataFrame(het_white(e, X_4), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het_final')

"""ÐžÑ†ÐµÐ½ÐºÐ° Ð¼Ð¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ (ÑƒÐ´Ð°Ð»Ð¸Ð¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Not_Phd_F)"""

X_mod = X_4.drop('Not_Phd_F', axis=1)
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg41 = sm.OLS(Y, X_mod)
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod41 = linreg41.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ 1 ******',
          file=fln)
    print(fitmod41.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod41.rsquared, fitmod41.rsquared_adj, fitmod41.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_final_mod_PF']).T
mq = pd.concat([mq, q])

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X_mod.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif_final_mod_PF')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod04.resid
WHT = pd.DataFrame(het_white(e, X_mod), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het_final_mod_PF')

"""ÐžÑ†ÐµÐ½ÐºÐ° Ð¼Ð¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ (ÑƒÐ´Ð°Ð»Ð¸Ð¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Male_YoE)"""

X_mod = X_4.drop('Male_YoE', axis=1)
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg42 = sm.OLS(Y, X_mod)
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod42 = linreg01.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ 2 ******',
          file=fln)
    print(fitmod42.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod42.rsquared, fitmod42.rsquared_adj, fitmod42.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_final_mod_MYoE']).T
mq = pd.concat([mq, q])

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X_mod.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif_final_mod_MYoE')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod42.resid
WHT = pd.DataFrame(het_white(e, X_mod), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het_final_mod_MYoE')

"""ÐžÑ†ÐµÐ½ÐºÐ° Ð¼Ð¾Ð´Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ (ÑƒÐ´Ð°Ð»Ð¸Ð¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Female_YoE)"""

X_mod = X_4.drop('Female_YoE', axis=1)
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ñ
linreg43 = sm.OLS(Y, X_mod)
# ÐžÑ†ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ
fitmod43 = linreg01.fit()
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¾Ñ†ÐµÐ½ÐºÐ¸ Ð² Ñ„Ð°Ð¹Ð»
with open('/content/drive/MyDrive/output/JOB_STAT.txt', 'a') as fln:
    print('\n ****** ÐžÑ†ÐµÐ½ÐºÐ° Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ 3 ******',
          file=fln)
    print(fitmod01.summary(), file=fln)

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
q = pd.DataFrame([fitmod43.rsquared, fitmod43.rsquared_adj, fitmod43.aic],
                 index=['R^2', 'adjR^2', 'AIC'], columns=['hyp_final_mod_FYoE']).T
mq = pd.concat([mq, q])

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð»Ð¸Ð½ÐµÐ°Ñ€Ð½Ð¾ÑÑ‚Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
from statsmodels.stats.outliers_influence import variance_inflation_factor
vif = pd.DataFrame() # Ð”Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
X_q = X_mod.select_dtypes(include='int64')# Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¾Ñ€Ñ‹
vif["vars"] = X_q.columns
vif["VIF"] = [variance_inflation_factor(X_q.values, i)
              for i in range(X_q.shape[1])]
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    vif.to_excel(wrt, sheet_name='vif_final_mod_FYoE')

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³ÐµÑ‚ÐµÑ€Ð¾ÑÐºÐµÐ´Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
# Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ñ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ White(Ð°) Ð¸ F ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ñ
from statsmodels.stats.diagnostic import het_white
e = fitmod43.resid
WHT = pd.DataFrame(het_white(e, X_mod), index= ['LM', 'LM_P', 'F', 'F_P'])
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    WHT.to_excel(wrt, sheet_name='het_final_mod_FYoE')

Y_test = JB_test['Salary']
DUM = pd.get_dummies(JB_test[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾
DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X_test = pd.concat([DUM, JB_test[['Years of Experience']]], axis=1)
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X_test = sm.add_constant(X_test)
X_test = X_test.astype({'const':'int64'})
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ð¹ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ
pred_ols = fitmod01.get_prediction(X_test.astype(float))
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð² Ñ Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ alpha
frm = pred_ols.summary_frame(alpha=0.05)
iv_l = frm["obs_ci_lower"] # ÐÐ¸Ð¶Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
iv_u = frm["obs_ci_upper"] # Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
fv = frm['mean'] # ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹
# ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²
mse = np.sqrt((Y_test - fv).pow(2).sum())/len(Y_test)
mae = np.sum(np.abs(Y_test - fv))

test_results.loc[len(test_results.index)] =["Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ", mse, mae, 1 - len(Y_test[(Y_test<frm["obs_ci_lower"])|(Y_test>frm["obs_ci_upper"])])/len(Y_test)]

name = 'Years of Experience' # Ð˜Ð¼Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ ÑÑ‚Ñ€Ð¾Ð¸Ð¼ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·
Z = X_test.loc[:, name]
dfn = pd.DataFrame([Z, Y_test, fv, iv_u, iv_l]).T
dfn = dfn.sort_values(by=name)
fig, ax = plt.subplots(figsize=(8, 6))
for z in dfn.columns[1:]:
    dfn.plot(x=dfn.columns[0], y=z, ax=ax)
ax.legend(loc="best")
plt.savefig('/content/drive/MyDrive/graphics/jobs_obs.pdf', format='pdf')
plt.show()

Y_test = JB_test['Salary']
DUM = pd.get_dummies(JB_test[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾
DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X_test = pd.concat([DUM, JB_test[['Years of Experience']]], axis=1)
X_test['Phd_F'] = X_test['Education Level_Phd'] * X_test['Gender_Female']
X_test['Not_Phd_F'] = (~X_test['Education Level_Phd']) * X_test['Gender_Female']
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X_test = sm.add_constant(X_test)
X_test = X_test.astype({'const':'int64'})
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ð¹ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ
pred_ols = fitmod02.get_prediction(X_test.astype(float))

frm = pred_ols.summary_frame(alpha=0.05)
iv_l = frm["obs_ci_lower"] # ÐÐ¸Ð¶Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
iv_u = frm["obs_ci_upper"] # Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
fv = frm['mean'] # ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹
# ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²
mse = np.sqrt((Y_test - fv).pow(2).sum())/len(Y_test)
mae = np.sum(np.abs(Y_test - fv))
test_results.loc[len(test_results.index)] = ["ÐŸÑ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð°Ñ 1", mse, mae, 1 - len(Y_test[(Y_test<frm["obs_ci_lower"])|(Y_test>frm["obs_ci_upper"])])/len(Y_test)]

Y_test = JB_test['Salary']
DUM = pd.get_dummies(JB_test[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾
DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X_test = pd.concat([DUM, JB_test[['Years of Experience']]], axis=1)
tmp = X_test['Years of Experience'] <= 3
X_test['Female_YoE'] = tmp * X_test['Gender_Female']
X_test['Male_YoE'] = tmp * (~X_test['Gender_Female'])
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X_test = sm.add_constant(X_test)
X_test = X_test.astype({'const':'int64'})
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ð¹ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ
pred_ols = fitmod03.get_prediction(X_test.astype(float))

frm = pred_ols.summary_frame(alpha=0.05)
iv_l = frm["obs_ci_lower"] # ÐÐ¸Ð¶Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
iv_u = frm["obs_ci_upper"] # Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
fv = frm['mean'] # ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹
# ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²
mse = np.sqrt((Y_test - fv).pow(2).sum())/len(Y_test)
mae = np.sum(np.abs(Y_test - fv))
test_results.loc[len(test_results.index)] = ["ÐŸÑ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð°Ñ 2", mse, mae, 1 - len(Y_test[(Y_test<frm["obs_ci_lower"])|(Y_test>frm["obs_ci_upper"])])/len(Y_test)]

Y_test = JB_test['Salary']
DUM = pd.get_dummies(JB_test[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾
DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X_test = pd.concat([DUM, JB_test[['Years of Experience']]], axis=1)
tmp = X_test['Years of Experience'] <= 3
X_test['Female_YoE'] = tmp * X_test['Gender_Female']
X_test['Male_YoE'] = tmp * (~X_test['Gender_Female'])
X_test['Phd_F'] = X_test['Education Level_Phd'] * X_test['Gender_Female']
X_test['Not_Phd_F'] = (~X_test['Education Level_Phd']) * X_test['Gender_Female']
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X_test = sm.add_constant(X_test)
X_test = X_test.astype({'const':'int64'})
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ð¹ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ
pred_ols = fitmod04.get_prediction(X_test.astype(float))

frm = pred_ols.summary_frame(alpha=0.05)
iv_l = frm["obs_ci_lower"] # ÐÐ¸Ð¶Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
iv_u = frm["obs_ci_upper"] # Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
fv = frm['mean'] # ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹
# ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð²
mse = np.sqrt((Y_test - fv).pow(2).sum())/len(Y_test)
mae = np.sum(np.abs(Y_test - fv))
test_results.loc[len(test_results.index)] = ["Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ", mse, mae, 1 - len(Y_test[(Y_test<frm["obs_ci_lower"])|(Y_test>frm["obs_ci_upper"])])/len(Y_test)]

Y_test = JB_test['Salary']
DUM = pd.get_dummies(JB_test[['Gender', 'Education Level', 'Job Group', 'Senior']])
# Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ð¾Ð¹Ð´ÑƒÑ‚ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ
# Ð‘ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½ Ð¾Ð´Ð¸Ð½ - Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹. Ð’Ð›Ð¸ÑÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð½Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼ÑƒÑŽ
# Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ Ð½ÐµÐ³Ð¾
DUM = DUM[['Gender_Female', 'Education Level_Bachelor Degree', 'Education Level_Master Degree', 'Education Level_Phd', 'Job Group_job_analyze', 'Job Group_job_client', 'Job Group_job_consult', 'Job Group_job_creativity', 'Job Group_job_marketing', 'Job Group_job_science', 'Job Group_job_technology', 'Senior_Yes']]
# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ pandas.DataFramee ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñƒ X Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ»ÐµÐ²Ð° Ñ„Ð¸ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
X_test = pd.concat([DUM, JB_test[['Years of Experience']]], axis=1)
tmp = X_test['Years of Experience'] <= 3
X_test['Female_YoE'] = tmp * X_test['Gender_Female']
X_test['Male_YoE'] = tmp * (~X_test['Gender_Female'])
X_test['Phd_F'] = X_test['Education Level_Phd'] * X_test['Gender_Female']
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ñ€Ð°Ð²Ð½ÑƒÑŽ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ðµ Ð´Ð»Ñ ÑƒÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ñ‹
X_test = sm.add_constant(X_test)
X_test = X_test.astype({'const':'int64'})
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ð¹ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ
pred_ols = fitmod41.get_prediction(X_test.astype(float))

frm = pred_ols.summary_frame(alpha=0.05)
iv_l = frm["obs_ci_lower"] # ÐÐ¸Ð¶Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
iv_u = frm["obs_ci_upper"] # Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð´Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð²
fv = frm['mean'] # ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹
#ÐŸÐ¾Ð´Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¸Ñ‚Ð¾Ð³Ð¾Ð²
mse = np.sqrt((Y_test - fv).pow(2).sum())/len(Y_test)
mae = np.sum(np.abs(Y_test - fv))

test_results.loc[len(test_results.index)] = ["Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ", mse, mae, 1 - len(Y_test[(Y_test<frm["obs_ci_lower"])|(Y_test>frm["obs_ci_upper"])])/len(Y_test)]
with pd.ExcelWriter('/content/drive/MyDrive/output/JOB_STAT.xlsx', engine="openpyxl",
                    if_sheet_exists='overlay', mode='a') as wrt:
    test_results.to_excel(wrt, sheet_name='Forecasts', index=False)

